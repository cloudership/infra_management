#!/bin/bash

set -euo pipefail

VERSION=1.3.9
INSTALL_DIR="${INSTALL_DIR:-/usr/bin}"

if [[ $(uname -m) == "x86_64" ]]; then
  SHA256=53048fa573effdd8f2a59b726234c6f450491fe0ded6931e9f4c6e3df6eece56
  URL_ARCH=amd64
elif [[ $(uname -m) == "aarch64" ]]; then
  SHA256=da571087268c5faf884912c4239c6b9c8e1ed8e8401ab1dcb45712df70f42f1b
  URL_ARCH=arm64
else
  echo "Unsupported architecture $(uname -m)" >&2
  exit 3
fi

cd /tmp
wget -q "https://releases.hashicorp.com/terraform/${VERSION}/terraform_${VERSION}_linux_${URL_ARCH}.zip" \
     -O terraform.zip
echo "${SHA256}  terraform.zip" | sha256sum -wc
unzip terraform.zip terraform
chmod +x terraform
cp terraform "${INSTALL_DIR}"
rm /tmp/terraform.zip /tmp/terraform
