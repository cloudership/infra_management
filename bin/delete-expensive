#!/bin/bash

set -euo pipefail

scriptdir="$(dirname "${BASH_SOURCE[0]}")"

if [[ -n "${ALL:-}" ]]; then
    NAT_INSTANCE=1
fi

"${scriptdir}/tg" prod apps_k8s --terragrunt-non-interactive apply -destroy -auto-approve

"${scriptdir}/tg" prod base_eks --terragrunt-non-interactive apply -destroy -auto-approve \
    -target=module.main_eks_cluster

if [[ -n "${NAT_INSTANCE:-}" ]]; then
    "${scriptdir}/tg" prod base --terragrunt-non-interactive apply -destroy -auto-approve \
        -target=module.nat_instance
fi
